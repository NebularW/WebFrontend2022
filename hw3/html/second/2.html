<!DOCTYPE html>
<html lang="ch">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scale=1">
    <title>秋日校园</title>
    <link rel="icon" type="image/png" sizes="128x128" href="../../assets/icons/128.ico">
    <link rel="stylesheet" type="text/css" href="../../css/global.css">
    <link rel="stylesheet" type="text/css" href="../../css/second.css">
</head>

<body>
<div id="second">
    <div class="header">
        <span class="title">秋日校园</span>
        <div class="btns">
            <button class="headerBtn" onclick="window.location.href = '../first.html'">主页</button>
            <button class="headerBtn" onclick="window.location.href = '../../index.html'">登出</button>
        </div>
    </div>

    <img class="itemImg" id="image" src="../../assets/pics/h1.jpg" alt="">
    <canvas id="canvas" width="250" height="300" style="border:1px solid #d3d3d3;">
        您的浏览器不支持 HTML5 canvas 标签。
    </canvas>
    <script src="../../js/cryptostego.min.js"></script>

    <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const img = document.getElementById("image");

        img.onload = function() {
            ctx.drawImage(img,10,10);
        }

        function writeIMG() {
            function writeFunc() {
                console.log("write")
                if (writeMsgToCanvas('canvas', "Sky 201250044", null, 3) != null) {
                    const myCanvas = document.getElementById("canvas");
                    const image = myCanvas.toDataURL("image/png", 1.0);
                    const element = document.createElement('a');
                    element.setAttribute('href', image);
                    element.setAttribute('download', 'result.jpg');
                    element.style.display = 'none';
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                }
                console.log("written")
            }

            // loadIMGtoCanvas('file', 'canvas', writeFunc, 500);
            writeFunc();
        }

        function readIMG() {
            function readFunc() {
                var t = readMsgFromCanvas('itemImg', null, 3);
                if (t != null) {
                    t = t.split('&').join('&amp;');
                    t = t.split(' ').join('&nbsp;');
                    t = t.split('<').join('&lt;');
                    t = t.split('>').join('&gt;');
                    t = t.replace(/(?:\r\n|\r|\n)/g, '<br />');
                    $("#result").html(t);
                } else $("#result").html('ERROR REAVEALING MESSAGE!');

            }

            loadIMGtoCanvas('file1', 'canvas', readFunc);
        }

        writeIMG();

    </script>

</div>
</body>


</html>